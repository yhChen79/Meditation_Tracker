function calculateStreak(userRecords) {
            if (!userRecords || Object.keys(userRecords).length === 0) {
                debugLog('沒有記錄，連續天數為 0');
                return 0;
            }
            
            // 找到最新的連續記錄
            let checkDate = new Date();
            checkDate.setHours(0, 0, 0, 0);
            
            debugLog(`開始計算連續天數，從 ${formatDate(checkDate)} 開始`);
            
            // 先找到最近的一個有記錄的日期作為起點
            let foundRecentRecord = false;
            let recentCheckDate = new Date(checkDate);
            
            // 往前找最多7天，尋找最近的記錄
            for (let i = 0; i < 7; i++) {
                const dateStr = formatDate(recentCheckDate);
                if (userRecords[dateStr] === true) {
                    checkDate = new Date(recentCheckDate);
                    foundRecentRecord = true;
                    debugLog(`找到最近的記錄日期: ${dateStr}`);
                    break;
                }
                recentCheckDate.setDate(recentCheckDate.getDate() - 1);
            }
            
            if (!foundRecentRecord) {
                debugLog('在過去7天內沒有找到任何記錄');
                return 0;
            }
            
            // 從找到的最近記錄日期開始，往前計算連續天數
            let streakCount = 0;
            
            while (true) {
                const dateStr = formatDate(checkDate);
                const isCompleted = userRecords[dateStr] === true;
                
                debugLog(`檢查日期: ${dateStr}, 是否完成: ${isCompleted}, 原始值: ${userRecords[dateStr]}`);
                
                if (isCompleted) {
                    streakCount++;
                    debugLog(`連續天數增加到: ${streakCount}`);
                    // 往前一天
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    debugLog(`在 ${dateStr} 中斷，最終連續天數: ${streakCount}`);
                    break;
                }
                
                // 防止無限循環，最多檢查 365 天
                if (streakCount > 365) {
                    debugLog('達到最大檢查天數限制');
                    break;
                }
            }
            
            return streakCount;
        }
